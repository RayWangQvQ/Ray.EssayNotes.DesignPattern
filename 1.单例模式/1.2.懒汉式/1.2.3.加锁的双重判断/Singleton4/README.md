# 加锁双重判断懒汉式

## 优点

* 懒加载

在类被装载时，不会去实例化单例对象，只有当首次调用 GetInstance() 方法时才会去实例化单例对象。

* 线程安全

因为在判断之前加了线程锁，所以在多线程的情况下不会重复创建实例。

** 如果是首次访问，实例还未被创建过： **

在首次调用 GetInstance() 方法时，假如有 2 两个线程同时进入方法，与前一种加锁方式不同，此时两个线程都会进入到 If 内部。

进入后，因为线程锁的原因，第一个进程获取到锁，并继续执行代码，第二个线程处于等待状态。

当第一个线程实例化单例对象后，释放同步锁，此时第二个线程可以加上同步锁，并去执行代码。

这时由于单例对象已经不为空了，所以第二个线程不会进入第二个 If 语句内部，就不会重复创建实例对象了。

所以第二个 If 是必须的，不然就是多线程不安全的，是错误的写法。

** 如果不是首次访问： **

每个线程都不会进入第一个 If 方法内，直接返回实例对象了。

* 避免效率浪费

效率指的是不是首次访问的情况。如果不是首次访问，也就是单例对象已经被创建过了，每个线程都不会进入第一个 If 语句，直接返回了已存在的单例对象，从而避免了不必要的加锁操作。

## 缺点

* 写法复杂，可读性差

## 注意

第二个 If 是必须的，理由如上。